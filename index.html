<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<title>Na MÃºsica Hoje</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto;
  background:linear-gradient(180deg,#0f0f0f,#1b0033);
  color:#fff;
}

.screen{display:none;padding:24px}
.active{display:block}

h1,h2{margin:10px 0 20px}

button{
  background:#7a2cff;
  border:none;
  color:#fff;
  padding:14px 20px;
  border-radius:16px;
  font-size:16px;
  margin:8px 0;
  width:100%;
}
button.secondary{background:#333}

.card{
  position:relative;
  display:flex;
  align-items:center;
  background:rgba(255,255,255,0.08);
  margin-bottom:14px;
  padding:14px;
  border-radius:18px;
  cursor:pointer;
}
.card img{
  width:72px;height:72px;border-radius:14px;margin-right:14px;object-fit:cover;
}

.badge{
  position:absolute;
  top:10px; right:10px;
  background:#ff7a00;
  color:#000;
  font-weight:700;
  font-size:12px;
  padding:6px 10px;
  border-radius:999px;
}

.song{
  background:rgba(255,255,255,0.08);
  border-radius:16px;
  padding:14px;
  margin-bottom:12px;
}

.footer{margin-top:30px}

/* SPINNER */
.spinner{
  width:40px;height:40px;
  border:4px solid rgba(255,255,255,0.2);
  border-top:4px solid #7a2cff;
  border-radius:50%;
  animation:spin 1s linear infinite;
  margin:40px auto;
}
@keyframes spin{to{transform:rotate(360deg)}}
</style>
</head>

<body>

<!-- TELA 1 -->
<div id="tela1" class="screen active">
  <h1>Na MÃºsica Hoje</h1>
  <button onclick="abrirPeriodo('hoje')">HOJE</button>
  <button onclick="abrirPeriodo('ontem')">ONTEM</button>
  <button onclick="abrirPeriodo('semana')">NA SEMANA</button>
  <div class="footer">
    <button class="secondary" onclick="sair()">SAIR</button>
  </div>
</div>

<!-- TELA 2 -->
<div id="tela2" class="screen">
  <h2 id="tituloPeriodo"></h2>
  <div id="listaArtistas"></div>
  <div class="footer">
    <button class="secondary" onclick="voltar(1)">VOLTAR</button>
    <button class="secondary" onclick="sair()">SAIR</button>
  </div>
</div>

<!-- TELA 3 -->
<div id="tela3" class="screen">
  <img id="fotoArtista" width="120" style="border-radius:24px"><br><br>
  <h2 id="nomeArtista"></h2>
  <div id="listaMusicas"></div>
  <div class="footer">
    <button class="secondary" onclick="voltar(2)">VOLTAR</button>
    <button class="secondary" onclick="sair()">SAIR</button>
  </div>
</div>

<script>
const API = "https://na-musica-hoje.onrender.com/period?period=";
let artistas = [];

function mostrar(id){
  document.querySelectorAll(".screen").forEach(s=>s.classList.remove("active"));
  document.getElementById(id).classList.add("active");
}

function sair(){ window.close(); }

async function abrirPeriodo(periodo){
  localStorage.setItem("ultimoPeriodo", periodo);
  mostrar("tela2");
  document.getElementById("tituloPeriodo").innerText = periodo.toUpperCase();
  document.getElementById("listaArtistas").innerHTML = '<div class="spinner"></div>';

  try{
    const r = await fetch(API + periodo);
    const d = await r.json();
    artistas = d.artists || [];

    // ranking jÃ¡ existente (proxy simples)
    artistas.sort((a,b)=>b.songs.length - a.songs.length);

    const lista = document.getElementById("listaArtistas");
    lista.innerHTML = "";

    if(!artistas.length){
      lista.innerHTML = "Nenhum lanÃ§amento encontrado.";
      return;
    }

    artistas.forEach((a,i)=>{
      const badge = i < 3 ? `<div class="badge">ðŸ”¥ LANÃ‡AMENTO GRANDE</div>` : "";
      lista.innerHTML += `
        <div class="card" onclick="abrirArtista(${i})">
          ${badge}
          <img src="${a.image}">
          <div>${a.artist}</div>
        </div>`;
    });

  }catch{
    document.getElementById("listaArtistas").innerHTML = "Erro ao carregar dados.";
  }
}

function abrirArtista(i){
  const a = artistas[i];
  document.getElementById("fotoArtista").src = a.image;
  document.getElementById("nomeArtista").innerText = a.artist;

  const lista = document.getElementById("listaMusicas");
  lista.innerHTML = "";
  a.songs.forEach(s=>{
    lista.innerHTML += `
      <div class="song">
        ${s.title}<br><br>
        <button onclick="window.open('${s.youtube}')">YouTube</button>
      </div>`;
  });
  mostrar("tela3");
}

function voltar(t){ mostrar("tela"+t); }

// abre onde parou
const ultimo = localStorage.getItem("ultimoPeriodo");
if(ultimo){ abrirPeriodo(ultimo); }
</script>

</body>
</html>
