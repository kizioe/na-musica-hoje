<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<title>Hoje na Música</title>

<style>
body {
  font-family: Arial, sans-serif;
  margin: 0;
  padding: 20px;
  background: #fff;
}
.hidden { display: none; }
button {
  width: 100%;
  padding: 14px;
  margin-bottom: 12px;
  font-size: 16px;
  border-radius: 10px;
  border: 2px solid orange;
  background: #fff;
}
.artist, .song {
  display: flex;
  align-items: center;
  background: linear-gradient(to right, #000, #555);
  color: #fff;
  padding: 15px;
  border-radius: 30px;
  margin-bottom: 15px;
}
.artist img {
  width: 55px;
  height: 55px;
  border-radius: 50%;
  margin-right: 15px;
}
.footer {
  position: fixed;
  bottom: 0;
  left: 0;
  right: 0;
  background: #eee;
  padding: 10px;
  display: flex;
  justify-content: space-between;
}
a {
  color: #1db954;
  margin-left: 10px;
}
</style>
</head>

<body>

<!-- TELA 1 -->
<div id="screen1">
  <h2>HOJENAMÚSICA</h2>
  <button onclick="loadPeriod('hoje')">HOJE</button>
  <button onclick="loadPeriod('ontem')">ONTEM</button>
  <button onclick="loadPeriod('semana')">NA SEMANA</button>
  <div class="footer">
    <span></span>
    <button onclick="exitApp()">SAIR</button>
  </div>
</div>

<!-- TELA 2 -->
<div id="screen2" class="hidden">
  <h3 id="periodTitle"></h3>
  <div id="artistList"></div>
  <div class="footer">
    <button onclick="goHome()">VOLTAR</button>
    <button onclick="exitApp()">SAIR</button>
  </div>
</div>

<!-- TELA 3 -->
<div id="screen3" class="hidden">
  <h3 id="artistName"></h3>
  <div id="songList"></div>
  <div class="footer">
    <button onclick="goArtists()">VOLTAR</button>
    <button onclick="exitApp()">SAIR</button>
  </div>
</div>

<script>
let currentArtists = [];

function show(screen) {
  document.querySelectorAll("div[id^='screen']").forEach(d => d.classList.add("hidden"));
  document.getElementById(screen).classList.remove("hidden");
}

function exitApp() {
  window.close();
}

function goHome() {
  show("screen1");
}

function goArtists() {
  show("screen2");
}

function loadPeriod(period) {
  fetch(`https://na-musica-hoje.onrender.com/period?period=${period}`)
    .then(r => r.json())
    .then(data => {
      document.getElementById("periodTitle").innerText =
        `Lançamentos — ${data.date}`;

      const list = document.getElementById("artistList");
      list.innerHTML = "";
      currentArtists = data.artists;

      data.artists.forEach((artist, index) => {
        const div = document.createElement("div");
        div.className = "artist";
        div.innerHTML = `
          <img src="${artist.photo || 'https://via.placeholder.com/100'}" />
          ${artist.name}
        `;
        div.onclick = () => openArtist(index);
        list.appendChild(div);
      });

      show("screen2");
    });
}

function openArtist(index) {
  const artist = currentArtists[index];
  document.getElementById("artistName").innerText = artist.name;

  const list = document.getElementById("songList");
  list.innerHTML = "";

  artist.songs.forEach(song => {
    const div = document.createElement("div");
    div.className = "song";
    div.innerHTML = `
      ${song}
      <div style="margin-left:auto">
        <a href="https://open.spotify.com/search/${encodeURIComponent(song + ' ' + artist.name)}" target="_blank">Spotify</a>
        <a href="https://www.youtube.com/results?search_query=${encodeURIComponent(song + ' ' + artist.name)}" target="_blank">YouTube</a>
      </div>
    `;
    list.appendChild(div);
  });

  show("screen3");
}
</script>

</body>
</html>
